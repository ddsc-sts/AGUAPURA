{% extends "base.html" %}
{% block title %}Pedido Confirmado - AGUAPURA{% endblock %}

{% block content %}

<!-- Mensagem de Confirma√ß√£o -->
{% if request.args.get('pago') == 'true' or pedido.pagamento_metodo == 'CARTAO' %}
<div style="max-width:900px; margin:30px auto 20px; padding:16px 24px; background:linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%); border:2px solid #28a745; border-radius:12px; text-align:center;">
  <div style="font-size:1.3rem; color:#155724; font-weight:700; margin-bottom:6px;">
    ‚úì Pagamento Recebido com Sucesso!
  </div>
  <div style="color:#155724; font-size:0.95rem;">
    Seu pagamento foi enviado para an√°lise. Um administrador aprovar√° em breve.
  </div>
</div>
{% endif %}

<!-- Nota Fiscal / Cupom -->
<div id="notaFiscal" style="max-width:900px; margin:30px auto; background:#ffffff; color:#000000; border:2px solid #333; border-radius:8px; box-shadow:0 8px 30px rgba(0,0,0,0.15);">
  
  <!-- Cabe√ßalho da Nota -->
  <div style="background:#f8f9fa; border-bottom:2px dashed #333; padding:24px;">
    
    <!-- IMPORTANTE: EDITE OS DADOS DA EMPRESA AQUI -->
    <div style="text-align:center; margin-bottom:20px;">
      <h1 style="margin:0 0 8px 0; font-size:2rem; color:#000;">AGUAPURA</h1>
      <div style="font-size:0.9rem; line-height:1.6;">
        <!-- EDITE: Nome fantasia ou raz√£o social -->
        <strong>AGUAPURA COM√âRCIO DE PRODUTOS LTDA</strong><br>
        
        <!-- EDITE: CNPJ da empresa -->
        <strong>CNPJ:</strong> XX.XXX.XXX/XXXX-XX<br>
        
        <!-- EDITE: Endere√ßo completo da empresa -->
        Rua XXXXXXXXXX, N¬∫ XXX - Bairro XXXXXX<br>
        CEP: XXXXX-XXX - Cidade/UF<br>
        
        <!-- EDITE: Telefone e email de contato -->
        Tel: (XX) XXXXX-XXXX | Email: aquapura.suporte@gmail.com
      </div>
    </div>
    <!-- FIM DA EDI√á√ÉO DOS DADOS DA EMPRESA -->

    <div style="text-align:center; padding:12px; background:#fff; border:2px solid #000; border-radius:6px;">
      <div style="font-size:1.2rem; font-weight:700; margin-bottom:4px;">CUPOM FISCAL ELETR√îNICO</div>
      <div style="font-size:0.85rem;">N√ÉO √â DOCUMENTO FISCAL</div>
    </div>
  </div>

  <!-- Informa√ß√µes do Pedido -->
  <div style="padding:24px; border-bottom:2px dashed #333;">
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px;">
      
      <!-- Coluna Esquerda -->
      <div>
        <div style="margin-bottom:12px;">
          <strong style="font-size:0.9rem; color:#666;">N√öMERO DO PEDIDO:</strong><br>
          <span style="font-size:1.3rem; font-weight:700;">#{{ pedido.id }}</span>
        </div>
        
        <div style="margin-bottom:12px;">
          <strong style="font-size:0.9rem; color:#666;">DATA E HORA:</strong><br>
          <span style="font-size:1rem;">{{ pedido.criado_em.strftime('%d/%m/%Y √†s %H:%M:%S') }}</span>
        </div>
        
        <div>
          <strong style="font-size:0.9rem; color:#666;">FORMA DE PAGAMENTO:</strong><br>
          <span style="font-size:1rem; font-weight:600;">
            {% if pedido.pagamento_metodo == 'PIX' %}
              üí≥ PIX
            {% elif pedido.pagamento_metodo == 'CARTAO' %}
              üí≥ CART√ÉO DE CR√âDITO
            {% else %}
              {{ pedido.pagamento_metodo }}
            {% endif %}
          </span>
        </div>
      </div>
      
      <!-- Coluna Direita -->
      <div>
        <div style="margin-bottom:12px;">
          <strong style="font-size:0.9rem; color:#666;">STATUS DO PEDIDO:</strong><br>
          <span style="font-size:1rem; font-weight:600; padding:6px 12px; background:#ffc107; color:#000; border-radius:6px; display:inline-block;">
            {{ pedido.status|replace('_',' ')|upper }}
          </span>
        </div>
        
        <div>
          <strong style="font-size:0.9rem; color:#666;">CLIENTE:</strong><br>
          <span style="font-size:1rem;">{{ pedido.cliente_nome }}</span><br>
          <span style="font-size:0.9rem; color:#666;">CPF: {{ pedido.cliente_cpf }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Endere√ßo de Entrega -->
  <div style="padding:24px; border-bottom:2px dashed #333; background:#fafafa;">
    <strong style="font-size:0.95rem; color:#666; display:block; margin-bottom:8px;">üìç ENDERE√áO DE ENTREGA:</strong>
    <div style="font-size:0.95rem; line-height:1.6;">
      {{ pedido.cliente_endereco }}
    </div>
  </div>

  <!-- Itens do Pedido -->
  <div style="padding:24px; border-bottom:2px dashed #333;">
    <strong style="font-size:1.1rem; display:block; margin-bottom:16px;">ITENS DO PEDIDO</strong>
    
    <table style="width:100%; border-collapse:collapse; font-size:0.9rem;">
      <thead>
        <tr style="border-bottom:2px solid #333;">
          <th style="text-align:left; padding:12px 8px; font-weight:700;">PRODUTO</th>
          <th style="text-align:center; padding:12px 8px; font-weight:700;">QTD</th>
          <th style="text-align:right; padding:12px 8px; font-weight:700;">VALOR UNIT.</th>
          <th style="text-align:right; padding:12px 8px; font-weight:700;">TOTAL</th>
        </tr>
      </thead>
      <tbody>
        {% for item in itens %}
        <tr style="border-bottom:1px solid #ddd;">
          <td style="padding:12px 8px;">
            <div style="display:flex; align-items:center; gap:10px;">
              <img src="{{ item.imagem_principal }}" alt="{{ item.nome }}" style="width:50px; height:50px; object-fit:cover; border-radius:6px; border:1px solid #ddd;">
              <div>
                <strong>{{ item.nome }}</strong>
                {% if item.personalizacao %}
                <div style="font-size:0.8rem; color:#666; margin-top:2px;">
                  üìù {{ item.personalizacao }}
                </div>
                {% endif %}
              </div>
            </div>
          </td>
          <td style="text-align:center; padding:12px 8px;">{{ item.quantidade }}</td>
          <td style="text-align:right; padding:12px 8px;">R$ {{ "%.2f"|format(item.valor) }}</td>
          <td style="text-align:right; padding:12px 8px; font-weight:600;">R$ {{ "%.2f"|format(item.valor * item.quantidade) }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Totais -->
  <div style="padding:24px;">
    {% set subtotal_calc = itens|sum(attribute='valor')|float * itens|sum(attribute='quantidade')|float %}
    {% set frete_calc = 12.00 %}
    {% set desconto_calc = pedido.desconto|float if pedido.desconto else 0.00 %}
    
    <div style="max-width:400px; margin-left:auto;">
      
      <div style="display:flex; justify-content:space-between; padding:8px 0; font-size:0.95rem;">
        <span>Subtotal dos produtos:</span>
        <strong>R$ {{ "%.2f"|format(subtotal_calc) }}</strong>
      </div>
      
      <div style="display:flex; justify-content:space-between; padding:8px 0; font-size:0.95rem;">
        <span>Frete:</span>
        <strong>
          {% if (pedido.valor_total|float - subtotal_calc + desconto_calc) == 0 %}
            <span style="color:#28a745;">GR√ÅTIS</span>
          {% else %}
            R$ {{ "%.2f"|format(pedido.valor_total|float - subtotal_calc + desconto_calc) }}
          {% endif %}
        </strong>
      </div>
      
      {% if desconto_calc > 0 %}
      <div style="display:flex; justify-content:space-between; padding:8px 0; font-size:0.95rem; color:#28a745;">
        <span>Desconto {% if pedido.cupom_usado %}({{ pedido.cupom_usado }}){% endif %}:</span>
        <strong>- R$ {{ "%.2f"|format(desconto_calc) }}</strong>
      </div>
      {% endif %}
      
      <div style="border-top:2px solid #333; margin-top:12px; padding-top:12px; display:flex; justify-content:space-between; font-size:1.3rem; font-weight:700;">
        <span>TOTAL:</span>
        <span>R$ {{ "%.2f"|format(pedido.valor_total) }}</span>
      </div>
    </div>
  </div>

  <!-- Rodap√© -->
  <div style="background:#f8f9fa; padding:20px; text-align:center; border-top:2px dashed #333; font-size:0.85rem; color:#666;">
    <p style="margin:0 0 8px 0;">Obrigado por comprar na AGUAPURA!</p>
    <p style="margin:0;">Para d√∫vidas ou suporte, entre em contato conosco.</p>
    <p style="margin:8px 0 0 0; font-size:0.75rem;">
      Documento emitido eletronicamente em {{ pedido.criado_em.strftime('%d/%m/%Y √†s %H:%M:%S') }}
    </p>
  </div>

</div>

<!-- Bot√µes de A√ß√£o -->
<div style="max-width:900px; margin:20px auto 40px; text-align:center; display:flex; gap:12px; justify-content:center; flex-wrap:wrap;">
  <button onclick="window.print()" style="padding:14px 32px; background:linear-gradient(135deg, #007bff 0%, #0056b3 100%); color:white; border:none; border-radius:10px; font-weight:600; cursor:pointer; font-size:1rem; transition:all 0.3s; box-shadow:0 4px 15px rgba(0,123,255,0.3);">
    üñ®Ô∏è Imprimir Nota Fiscal
  </button>
  
  <a href="{{ url_for('perfil') }}" style="padding:14px 32px; background:linear-gradient(135deg, #28a745 0%, #20923a 100%); color:white; border:none; border-radius:10px; font-weight:600; cursor:pointer; font-size:1rem; text-decoration:none; display:inline-block; transition:all 0.3s; box-shadow:0 4px 15px rgba(40,167,69,0.3);">
    üì¶ Ver Meus Pedidos
  </a>
  
  <a href="{{ url_for('home') }}" style="padding:14px 32px; background:var(--card-bg); color:var(--texto); border:2px solid var(--border); border-radius:10px; font-weight:600; cursor:pointer; font-size:1rem; text-decoration:none; display:inline-block; transition:all 0.3s;">
    üè† Voltar ao In√≠cio
  </a>
</div>

<style>
/* Estilos para impress√£o */
@media print {
  body * {
    visibility: hidden;
  }
  
  #notaFiscal, #notaFiscal * {
    visibility: visible;
  }
  
  #notaFiscal {
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    margin: 0;
    border: none;
    box-shadow: none;
  }
  
  /* Esconde mensagem de confirma√ß√£o na impress√£o */
  div[style*="background:linear-gradient(135deg, #d4edda"] {
    display: none !important;
  }
}

/* Hover nos bot√µes */
button:hover, a[style*="background:linear-gradient"]:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.2) !important;
}

button:active, a[style*="background:linear-gradient"]:active {
  transform: translateY(0);
}
</style>

{% endblock %}