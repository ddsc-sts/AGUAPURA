{% extends "base.html" %}
{% block title %}{{ product.name }} - AguaPura{% endblock %}

{% block content %}
<style>
  .product-detail {
    position: relative;
    max-width: 1200px;
    margin: 40px auto;
    padding: 30px;
  }

  /* Bot√£o de Favorito */
  .btn-favorito-produto {
    position: fixed;
    top: 150px;
    right: 30px;
    background: rgba(255, 255, 255, 0.95);
    border: 2px solid var(--border);
    border-radius: 50%;
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 28px;
    z-index: 1000;
    backdrop-filter: blur(10px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    transition: all 0.3s ease;
  }

  [data-theme="dark"] .btn-favorito-produto {
    background: rgba(30, 41, 59, 0.95);
    border-color: #475569;
  }

  .btn-favorito-produto:hover {
    transform: scale(1.15);
    box-shadow: 0 6px 25px rgba(239, 68, 68, 0.4);
  }

  .btn-favorito-produto.favoritado {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    border-color: #ef4444;
  }

  .btn-favorito-produto.favoritado {
    color: white;
  }

  .btn-favorito-produto:not(.favoritado) {
    color: #94a3b8;
  }

  @media (max-width: 768px) {
    .btn-favorito-produto {
      width: 50px;
      height: 50px;
      font-size: 24px;
      top: 120px;
      right: 15px;
    }
  }
</style>

<div class="product-detail">
  
  <!-- ‚úÖ BOT√ÉO DE FAVORITO FIXO NO CANTO -->
  {% if session.get("logado") %}
  <form action="{% if is_favorito(product.id) %}{{ url_for('remover_favorito', produto_id=product.id) }}{% else %}{{ url_for('adicionar_favorito', produto_id=product.id) }}{% endif %}" 
        method="post">
    <button type="submit" 
            class="btn-favorito-produto {% if is_favorito(product.id) %}favoritado{% endif %}"
            title="{% if is_favorito(product.id) %}Remover dos favoritos{% else %}Adicionar aos favoritos{% endif %}">
      {% if is_favorito(product.id) %}‚ù§Ô∏è{% else %}ü§ç{% endif %}
    </button>
  </form>
  {% endif %}

  {% if product.image_url %}
    {% if product.image_url.startswith('http') %}
      <img src="{{ product.image_url }}" alt="{{ product.name }}">
    {% else %}
      <img src="{{ url_for('static', filename='img/' + product.image_url) }}" alt="{{ product.name }}">
    {% endif %}
  {% else %}
    <img src="{{ url_for('static', filename='img/default_product.png') }}" alt="Sem imagem">
  {% endif %}

  <div class="product-info">
    <h1>{{ product.name }}</h1>
    <p class="price">üí∞ R$ {{ '%.2f'|format(product.price) }}</p>
    {% if product.description %}
      <p class="desc">üìò {{ product.description }}</p>
    {% endif %}
    <p class="stock">üì¶ Em estoque: {{ product.stock }}</p>

    <form action="{{ url_for('add_to_cart', produto_id=product.id) }}" method="post">
      <label for="qty">Quantidade:</label>
      <input type="number" name="qty" id="qty" min="1" value="1">
      <button class="btn">Adicionar ao carrinho</button>
    </form>
  </div>
</div>
{% endblock %}