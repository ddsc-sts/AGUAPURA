{% extends "base.html" %}
{% block title %}Carrinho - AQUAPURA{% endblock %}

{% block content %}
<div style="max-width:1200px; margin:40px auto; padding:20px;">
    <h2 style="margin-bottom:30px; font-size:2rem;">üõí Seu Carrinho</h2>

    {% if itens|length == 0 %}
        <div style="text-align:center; padding:60px 20px; background:var(--card-bg); border-radius:16px; border:1px solid var(--border);">
            <div style="font-size:4rem; margin-bottom:16px;">üõí</div>
            <h3 style="margin-bottom:8px;">Seu carrinho est√° vazio</h3>
            <p style="color:var(--texto); opacity:0.7; margin-bottom:24px;">Adicione produtos incr√≠veis para come√ßar!</p>
            <a href="{{ url_for('home') }}" class="btn-primary" style="display:inline-block; padding:12px 32px; border-radius:10px; background:#007bff; color:#fff; text-decoration:none; font-weight:600;">
                Explorar Produtos
            </a>
        </div>
    {% else %}

    <div style="display:grid; grid-template-columns:1fr 400px; gap:24px; align-items:start;">
        
        <!-- LISTA DE ITENS -->
        <div style="display:flex; flex-direction:column; gap:16px;">
            {% for item in itens %}
            <div class="glass-card" style="padding:20px; border-radius:16px; display:flex; gap:20px; position:relative;">
                
                <!-- Imagem -->
                <img src="{{ item.imagem_principal }}" alt="{{ item.nome }}" 
                     style="width:120px; height:120px; object-fit:cover; border-radius:12px; flex-shrink:0;">
                
                <!-- Info do produto -->
                <div style="flex:1;">
                    <h3 style="margin:0 0 8px 0; font-size:1.2rem;">{{ item.nome }}</h3>
                    <p style="color:#007bff; font-weight:700; font-size:1.1rem; margin:0 0 12px 0;">
                        R$ {{ "%.2f"|format(item.preco) }}
                    </p>
                    
                    {% if item.cor and item.cor != '' %}
                    <div style="margin-bottom:8px;">
                        <span style="display:inline-block; padding:4px 12px; background:rgba(0,123,255,0.1); border-radius:6px; font-size:0.85rem;">
                            <strong>Cor:</strong> {{ item.cor }}
                        </span>
                    </div>
                    {% endif %}

                    <!-- Mostrar personaliza√ß√£o (somente se existir) -->
                    {% if item.personalizacao %}
                    <div style="margin-bottom:12px; display:flex; align-items:center; gap:10px;">
                        <span style="display:inline-block; padding:6px 14px; background:rgba(0,200,100,0.1); border:1px solid rgba(0,200,100,0.3); border-radius:8px; font-size:0.9rem;">
                            ‚úèÔ∏è Personalizado: <strong>{{ item.personalizacao }}</strong>
                        </span>
                        <span style="font-size:0.85rem; color:var(--azul); font-weight:600;">
                            + R$ 10,00
                        </span>
                    </div>
                    {% endif %}

                    <!-- Mostrar estampa com IMAGEM -->
                    {% if item.estampa %}
                    <div style="margin-bottom:12px; display:flex; align-items:center; gap:10px;">
                        <span style="font-size:0.85rem; color:var(--texto); opacity:0.8;">
                            <strong>Estampa:</strong>
                        </span>
                        <img src="/static/estampas/{{ item.estampa }}" 
                             alt="Estampa escolhida"
                             style="width:50px; height:50px; object-fit:cover; border-radius:8px; border:2px solid var(--azul);">
                        <span style="font-size:0.85rem; color:var(--azul); font-weight:600;">
                            + R$ 20,00
                        </span>
                    </div>
                    {% endif %}

                    
                    <!-- Quantidade -->
                    <div style="display:flex; align-items:center; gap:12px; margin-top:16px;">
                        <span style="font-size:0.9rem; color:var(--texto); opacity:0.8;">Quantidade:</span>
                        <div style="display:flex; align-items:center; gap:8px; border:1px solid var(--border); border-radius:8px; padding:4px;">
                            <a href="/carrinho/sub/{{ item.carrinho_id }}" style="text-decoration:none;">
                                <button style="width:32px; height:32px; border:none; background:#007bff; color:#fff; cursor:pointer; font-size:1.2rem; border-radius:6px; font-weight:bold;">‚àí</button>
                            </a>
                            <span style="min-width:40px; text-align:center; font-weight:600;">{{ item.quantidade }}</span>
                            <a href="/carrinho/add/{{ item.carrinho_id }}" style="text-decoration:none;">
                                <button style="width:32px; height:32px; border:none; background:#007bff; color:#fff; cursor:pointer; font-size:1.2rem; border-radius:6px; font-weight:bold;">+</button>
                            </a>
                        </div>
                        <span style="margin-left:auto; font-weight:700; font-size:1.1rem;">
                            R$ {{ "%.2f"|format((item.preco + (item.extra_preco or 0)) * item.quantidade) }}
                        </span>
                    </div>
                </div>
                
                <!-- Bot√£o remover -->
                <a href="/carrinho/remover/{{ item.carrinho_id }}" 
                   style="position:absolute; top:16px; right:16px; color:#ff4444; font-size:1.2rem; text-decoration:none; cursor:pointer; width:32px; height:32px; display:flex; align-items:center; justify-content:center; border-radius:50%; transition:background 0.2s;"
                   onmouseover="this.style.background='rgba(255,68,68,0.1)'"
                   onmouseout="this.style.background='transparent'">
                    ‚úñ
                </a>
            </div>
            {% endfor %}
        </div>

        <!-- RESUMO -->
        <div style="position:sticky; top:20px;">
            <!-- Cupom -->
            <div class="glass-card" style="padding:20px; border-radius:16px; margin-bottom:16px;">
                <h3 style="margin:0 0 16px 0; font-size:1.1rem;">üéüÔ∏è Cupom de Desconto</h3>
                
                {% if cupom_info %}
                <div style="padding:12px; background:rgba(0,200,100,0.1); border-radius:8px; border:1px solid rgba(0,200,100,0.3); margin-bottom:12px;">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <strong style="color:#00c864;">{{ cupom_info.codigo }}</strong>
                            <p style="margin:4px 0 0 0; font-size:0.85rem; opacity:0.8;">
                                {% if cupom_info.tipo == 'percentual' %}
                                    {{ cupom_info.valor }}% de desconto
                                {% else %}
                                    R$ {{ "%.2f"|format(cupom_info.valor) }} de desconto
                                {% endif %}
                            </p>
                        </div>
                        <a href="{{ url_for('remover_cupom') }}" style="color:#ff4444; text-decoration:none; font-size:1.2rem;">‚úñ</a>
                    </div>
                </div>
                {% else %}
                <form method="post" action="{{ url_for('aplicar_cupom') }}" style="display:flex; gap:8px;">
                    <input type="text" 
                           name="codigo_cupom" 
                           placeholder="Digite o c√≥digo" 
                           class="glass-input"
                           style="flex:1; padding:10px 12px; border-radius:8px; border:1px solid var(--border); background:var(--card-bg); color:var(--texto);"
                           autocomplete="off"
                           required>
                    <button type="submit" style="padding:10px 20px; border-radius:8px; background:#007bff; color:#fff; border:none; cursor:pointer; font-weight:600; white-space:nowrap;">
                        Aplicar
                    </button>
                </form>
                {% endif %}
            </div>

            <!-- Resumo do pedido -->
            <div class="glass-card" style="padding:20px; border-radius:16px;">
                <h3 style="margin:0 0 20px 0; font-size:1.1rem;">Resumo do Pedido</h3>
                
                <div style="display:flex; justify-content:space-between; margin-bottom:12px; font-size:0.95rem;">
                    <span style="color:var(--texto); opacity:0.8;">Subtotal</span>
                    <span style="font-weight:600;">R$ {{ "%.2f"|format(subtotal) }}</span>
                </div>
                
                <div style="display:flex; justify-content:space-between; margin-bottom:12px; font-size:0.95rem;">
                    <span style="color:var(--texto); opacity:0.8;">Frete</span>
                    <span style="font-weight:600;">R$ {{ "%.2f"|format(frete) }}</span>
                </div>
                
                {% if desconto > 0 %}
                <div style="display:flex; justify-content:space-between; margin-bottom:12px; font-size:0.95rem; color:#00c864;">
                    <span>Desconto</span>
                    <span style="font-weight:600;">- R$ {{ "%.2f"|format(desconto) }}</span>
                </div>
                {% endif %}

                <hr style="margin:16px 0; border:none; border-top:1px solid var(--border);">

                <div style="display:flex; justify-content:space-between; margin-bottom:24px; font-size:1.3rem;">
                    <strong>Total</strong>
                    <strong style="color:#007bff;">R$ {{ "%.2f"|format(total) }}</strong>
                </div>

                <a href="{{ url_for('checkout') }}" class="btn-checkout" 
                   style="display:block; text-align:center; padding:16px; border-radius:12px; background:linear-gradient(135deg, #007bff 0%, #0056b3 100%); color:#fff; text-decoration:none; font-weight:700; font-size:1.05rem; transition:all 0.3s; box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);">
                    Finalizar Compra üöÄ
                </a>
                
                <a href="{{ url_for('home') }}" 
                   style="display:block; text-align:center; margin-top:12px; color:var(--texto); opacity:0.7; text-decoration:none; font-size:0.9rem;">
                    ‚Üê Continuar comprando
                </a>
            </div>
        </div>

    </div>

    {% endif %}
</div>

<style>
.glass-card {
    background: var(--card-bg);
    border: 1px solid var(--border);
    box-shadow: 0 4px 16px var(--shadow);
}

.glass-input {
    outline: none;
    transition: border 0.2s;
}

.glass-input:focus {
    border-color: #007bff !important;
}

.btn-checkout:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 123, 255, 0.4);
}

.btn-checkout:active {
    transform: translateY(0);
}

/* Modo escuro - ajustes do input */
body.dark .glass-input {
    background: #1e1e1e;
    color: #fff;
    border-color: #444;
}

body.dark .btn-checkout {
    background: linear-gradient(135deg, #0d6efd 0%, #0a58ca 100%);
    box-shadow: 0 4px 15px rgba(13, 110, 253, 0.4);
}

body.dark .btn-checkout:hover {
    box-shadow: 0 6px 20px rgba(13, 110, 253, 0.5);
}

@media (max-width: 968px) {
    div[style*="grid-template-columns"] {
        grid-template-columns: 1fr !important;
    }
}
</style>

{% endblock %}